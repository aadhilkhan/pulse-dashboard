<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulse - Analytics Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        vermillion: {
          50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd',
          400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8',
          800: '#1e40af', 900: '#1e3a8a',
        }
      },
      fontFamily: { sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'] },
      animation: {
        'fade-in': 'fadeIn 0.4s ease-out both',
        'slide-up': 'slideUp 0.4s ease-out both',
        'slide-right': 'slideRight 0.3s ease-out both',
      },
      keyframes: {
        fadeIn: { from: { opacity: '0' }, to: { opacity: '1' } },
        slideUp: { from: { opacity: '0', transform: 'translateY(16px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
        slideRight: { from: { opacity: '0', transform: 'translateX(-16px)' }, to: { opacity: '1', transform: 'translateX(0)' } },
      }
    }
  }
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Inter',sans-serif;transition:background-color .2s ease,color .2s ease}
  .sidebar-link.active{background:linear-gradient(135deg,#3b82f6,#60a5fa);color:#fff}
  .sidebar-link.active svg{color:#fff}
  .grad-1{background:linear-gradient(135deg,#3b82f6,#2563eb)}
  .grad-2{background:linear-gradient(135deg,#93c5fd,#3b82f6)}
  .grad-3{background:linear-gradient(135deg,#4facfe,#00f2fe)}
  .grad-4{background:linear-gradient(135deg,#43e97b,#38f9d7)}
  .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,0.88)}
  ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#f1f5f9}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}
  .notification-dot::after{content:'';position:absolute;top:0;right:0;width:8px;height:8px;background:#ef4444;border-radius:50%;border:2px solid #fff}
  .tab-active{background:#fff;color:#2563eb;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
  .dark-mode{background:#020617!important;color:#cbd5e1}
  .dark-mode aside,.dark-mode #notifPanel,.dark-mode .bg-white{background-color:#0f172a!important}
  .dark-mode .glass{background:rgba(15,23,42,.82);border-color:#334155!important}
  .dark-mode .bg-slate-50,.dark-mode .bg-slate-50\/50{background-color:#1e293b!important}
  .dark-mode .bg-slate-100,.dark-mode .bg-slate-200{background-color:#334155!important}
  .dark-mode .border-slate-50,.dark-mode .border-slate-100,.dark-mode .border-slate-200,.dark-mode .border-slate-200\/60{border-color:#334155!important}
  .dark-mode .text-slate-800{color:#e2e8f0!important}
  .dark-mode .text-slate-700{color:#cbd5e1!important}
  .dark-mode .text-slate-600,.dark-mode .text-slate-500{color:#94a3b8!important}
  .dark-mode .text-slate-400{color:#64748b!important}
  .dark-mode .hover\:bg-slate-50:hover{background-color:#1e293b!important}
  .dark-mode .hover\:bg-slate-100:hover,.dark-mode .hover\:bg-slate-200:hover{background-color:#334155!important}
  .dark-mode input,.dark-mode select,.dark-mode textarea{background-color:#0b1220!important;color:#e2e8f0!important;border-color:#334155!important}
  .dark-mode input::placeholder,.dark-mode textarea::placeholder{color:#64748b}
  .dark-mode .tab-active{background:#1d4ed8;color:#dbeafe;box-shadow:0 2px 8px rgba(0,0,0,0.35)}
  .dark-mode .notification-dot::after{border-color:#0f172a}
  .dark-mode #modal{background:rgba(2,6,23,.7)}
  .dark-mode ::-webkit-scrollbar-track{background:#0b1220}
  .dark-mode ::-webkit-scrollbar-thumb{background:#334155}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body class="bg-slate-50 min-h-screen">

<!-- Sidebar -->
<aside class="fixed left-0 top-0 h-full w-64 bg-white border-r border-slate-200 z-40 flex flex-col">
  <div class="p-6 border-b border-slate-100">
    <div class="flex items-center gap-3 cursor-pointer" onclick="navigate('dashboard')">
      <div class="w-9 h-9 rounded-xl grad-1 flex items-center justify-center"><i data-lucide="activity" class="w-5 h-5 text-white"></i></div>
      <span class="text-xl font-bold text-slate-800">Pulse</span>
    </div>
  </div>
  <nav class="flex-1 p-4 space-y-1" id="sidebarNav"></nav>
  <div class="p-4 border-t border-slate-100">
    <div class="flex items-center gap-3 px-3 py-2 cursor-pointer rounded-xl hover:bg-slate-50 transition-colors" onclick="navigate('settings')">
      <div class="w-9 h-9 rounded-full bg-gradient-to-br from-vermillion-400 to-vermillion-600 flex items-center justify-center text-white text-sm font-semibold" id="userAvatar">A</div>
      <div class="flex-1 min-w-0">
        <div class="text-sm font-semibold text-slate-700 truncate" id="userName">Aadhil Khan</div>
        <div class="text-xs text-slate-400 truncate" id="userEmail">admin@pulse.dev</div>
      </div>
      <i data-lucide="settings" class="w-4 h-4 text-slate-400"></i>
    </div>
  </div>
</aside>

<!-- Main -->
<main class="ml-64 min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-30 glass border-b border-slate-200/60">
    <div class="flex items-center justify-between px-8 py-4">
      <div>
        <h1 class="text-2xl font-bold text-slate-800" id="pageTitle">Dashboard</h1>
        <p class="text-sm text-slate-500 mt-0.5" id="pageSubtitle"></p>
      </div>
      <div class="flex items-center gap-3">
        <div class="relative">
          <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
          <input id="globalSearch" type="text" placeholder="Search... (Cmd+K)" class="w-64 pl-10 pr-4 py-2 bg-slate-100 rounded-xl text-sm border border-transparent focus:border-vermillion-300 focus:bg-white focus:ring-2 focus:ring-vermillion-100 outline-none transition-all" oninput="handleGlobalSearch(this.value)">
          <div id="searchDropdown" class="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden hidden z-50 max-h-80 overflow-y-auto"></div>
        </div>
        <button onclick="toggleNotifications()" class="relative p-2 rounded-xl hover:bg-slate-100 transition-colors notification-dot" id="notifBellBtn">
          <i data-lucide="bell" class="w-5 h-5 text-slate-600"></i>
        </button>
        <button onclick="toggleTheme()" id="themeToggleBtn" class="p-2 rounded-xl hover:bg-slate-100 transition-colors" title="Dark mode" aria-label="Switch to dark mode">
          <i data-lucide="moon" class="w-5 h-5 text-slate-600"></i>
        </button>
        <button onclick="doExport()" id="headerExportBtn" class="flex items-center gap-2 px-4 py-2 bg-vermillion-600 text-white rounded-xl text-sm font-medium hover:bg-vermillion-700 active:scale-95 transition-all shadow-sm shadow-vermillion-200">
          <i data-lucide="download" class="w-4 h-4"></i> Export
        </button>
      </div>
    </div>
  </header>

  <div class="p-8" id="pageContent"></div>
</main>

<!-- Modal -->
<div id="modal" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 hidden flex items-center justify-center" onclick="if(event.target===this)closeModal()">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
    <div class="p-6" id="modalBody"></div>
  </div>
</div>

<!-- Notification Panel -->
<div id="notifPanel" class="fixed top-0 right-0 h-full w-96 bg-white shadow-2xl border-l border-slate-200 z-50 transform translate-x-full transition-transform duration-300">
  <div class="flex items-center justify-between p-6 border-b border-slate-100">
    <h2 class="text-lg font-bold text-slate-800">Notifications</h2>
    <div class="flex items-center gap-2">
      <button onclick="markAllRead()" class="text-xs text-vermillion-600 font-semibold hover:underline">Mark all read</button>
      <button onclick="toggleNotifications()" class="p-1 rounded-lg hover:bg-slate-100 transition-colors"><i data-lucide="x" class="w-5 h-5 text-slate-500"></i></button>
    </div>
  </div>
  <div class="p-4 space-y-2 overflow-y-auto" style="max-height:calc(100vh - 80px)" id="notifList"></div>
</div>

<script>
// =============================================
// STATE
// =============================================
let currentPage = 'dashboard';
let chartInstances = {};
const dateRanges = ['7d','30d','90d','1y'];
let activeDateRange = '30d';

const state = {
  settings: {
    name: 'Aadhil Khan', email: 'admin@pulse.dev', company: 'Pulse Inc.',
    notifications: { email: true, push: true, weekly: false, marketing: false },
    theme: 'light'
  },
  notifications: [
    { id:1, icon:'alert-circle', color:'text-red-500 bg-red-50', title:'Server Alert', desc:'CPU usage exceeded 90% threshold', time: Date.now()-300000, read:false },
    { id:2, icon:'user-plus', color:'text-vermillion-500 bg-vermillion-50', title:'New Team Member', desc:'Sarah Kim joined the engineering team', time: Date.now()-3600000, read:false },
    { id:3, icon:'check-circle', color:'text-emerald-500 bg-emerald-50', title:'Deployment Complete', desc:'v2.4.1 deployed to production successfully', time: Date.now()-10800000, read:false },
    { id:4, icon:'trending-up', color:'text-amber-500 bg-amber-50', title:'Revenue Milestone', desc:'Monthly revenue exceeded $45,000 target', time: Date.now()-86400000, read:true },
  ],
  customers: [
    { id:1, name:'Alice Johnson', email:'alice@example.com', spent:8920, orders:12, status:'active', joined:'2025-03-15', avatar:'AJ', color:'from-vermillion-400 to-rose-500', phone:'+1 555-0101', city:'San Francisco' },
    { id:2, name:'Bob Smith', email:'bob@company.co', spent:4350, orders:6, status:'active', joined:'2025-05-22', avatar:'BS', color:'from-blue-400 to-cyan-500', phone:'+1 555-0102', city:'New York' },
    { id:3, name:'Carol Williams', email:'carol@design.io', spent:12470, orders:18, status:'active', joined:'2024-11-08', avatar:'CW', color:'from-emerald-400 to-teal-500', phone:'+1 555-0103', city:'Austin' },
    { id:4, name:'David Brown', email:'david@startup.dev', spent:1890, orders:3, status:'inactive', joined:'2025-08-01', avatar:'DB', color:'from-orange-400 to-red-500', phone:'+1 555-0104', city:'Seattle' },
    { id:5, name:'Eva Martinez', email:'eva@agency.com', spent:21000, orders:24, status:'active', joined:'2024-06-14', avatar:'EM', color:'from-pink-400 to-rose-500', phone:'+1 555-0105', city:'Miami' },
    { id:6, name:'Frank Lee', email:'frank@tech.io', spent:5670, orders:8, status:'active', joined:'2025-01-20', avatar:'FL', color:'from-vermillion-400 to-blue-500', phone:'+1 555-0106', city:'Chicago' },
    { id:7, name:'Grace Chen', email:'grace@lab.org', spent:34200, orders:31, status:'vip', joined:'2023-12-05', avatar:'GC', color:'from-amber-400 to-orange-500', phone:'+1 555-0107', city:'Boston' },
    { id:8, name:'Henry Wilson', email:'henry@corp.net', spent:7500, orders:10, status:'active', joined:'2025-04-11', avatar:'HW', color:'from-teal-400 to-emerald-500', phone:'+1 555-0108', city:'Denver' },
  ],
  orders: [
    { id:'ORD-4821', customer:'Grace Chen', items:['Pro Plan (Annual)','Add-on: Analytics'], total:3420, status:'delivered', date:'2026-02-12', tracking:'1Z999AA10123456784' },
    { id:'ORD-4820', customer:'Eva Martinez', items:['Enterprise License'], total:2100, status:'shipped', date:'2026-02-11', tracking:'1Z999AA10123456783' },
    { id:'ORD-4819', customer:'Carol Williams', items:['Pro Plan (Monthly)','Support Package'], total:1247, status:'shipped', date:'2026-02-11', tracking:'1Z999AA10123456782' },
    { id:'ORD-4818', customer:'Alice Johnson', items:['Pro Plan (Monthly)'], total:892, status:'processing', date:'2026-02-10', tracking:null },
    { id:'ORD-4817', customer:'Henry Wilson', items:['Starter Plan','Add-on: Reports'], total:750, status:'delivered', date:'2026-02-09', tracking:'1Z999AA10123456781' },
    { id:'ORD-4816', customer:'Frank Lee', items:['Pro Plan (Monthly)'], total:567, status:'processing', date:'2026-02-08', tracking:null },
    { id:'ORD-4815', customer:'Bob Smith', items:['Starter Plan'], total:435, status:'pending', date:'2026-02-07', tracking:null },
    { id:'ORD-4814', customer:'David Brown', items:['Trial Extension'], total:189, status:'cancelled', date:'2026-02-06', tracking:null },
  ],
  products: [
    { id:1, name:'Starter Plan', price:29, stock:999, category:'Subscription', status:'active', sales:342, desc:'Basic analytics for small teams', icon:'zap' },
    { id:2, name:'Pro Plan (Monthly)', price:79, stock:999, category:'Subscription', status:'active', sales:518, desc:'Advanced analytics with custom reports', icon:'bar-chart-3' },
    { id:3, name:'Pro Plan (Annual)', price:790, stock:999, category:'Subscription', status:'active', sales:156, desc:'Annual billing - save 17%', icon:'calendar' },
    { id:4, name:'Enterprise License', price:2100, stock:999, category:'License', status:'active', sales:42, desc:'Unlimited seats, priority support', icon:'building-2' },
    { id:5, name:'Add-on: Analytics', price:19, stock:999, category:'Add-on', status:'active', sales:287, desc:'Deep dive analytics module', icon:'pie-chart' },
    { id:6, name:'Add-on: Reports', price:15, stock:999, category:'Add-on', status:'active', sales:195, desc:'Custom PDF report generation', icon:'file-text' },
    { id:7, name:'Support Package', price:49, stock:999, category:'Service', status:'active', sales:88, desc:'Priority email & chat support', icon:'headphones' },
    { id:8, name:'Trial Extension', price:0, stock:999, category:'Promotion', status:'draft', sales:463, desc:'14-day trial extension', icon:'clock' },
  ],
  helpArticles: [
    { q:'How do I upgrade my plan?', a:'Navigate to Settings > Billing, click "Change Plan", select your desired plan and confirm. Your new features will be available immediately and billing will be prorated.' },
    { q:'How do I add team members?', a:'Go to Settings > Team, click "Invite Member", enter their email address and select a role (Admin, Editor, or Viewer). They\'ll receive an invitation email.' },
    { q:'How do I export my data?', a:'Click the "Export" button in the top-right corner of any page. You can export as CSV. The export includes all visible data based on your current filters.' },
    { q:'How do I set up notifications?', a:'Visit Settings > Notifications to configure email alerts, push notifications, weekly digests, and marketing updates. Changes are saved automatically.' },
    { q:'What analytics are tracked?', a:'Pulse tracks page views, unique visitors, session duration, bounce rate, conversion events, revenue, and custom events. All data is available via the Analytics page.' },
    { q:'How do I cancel my subscription?', a:'Go to Settings > Billing > Cancel Subscription. Your access continues until the end of your billing period. Data is retained for 30 days after cancellation.' },
  ]
};

// Revenue data for different ranges
const revenueByRange = {
  '7d':  { labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], rev:[6.2,7.8,5.9,8.1,9.2,4.5,6.7], exp:[4.1,5.2,3.8,5.5,6.1,3.2,4.5] },
  '30d': { labels:['W1','W2','W3','W4'], rev:[11.2,12.8,10.5,13.9], exp:[7.5,8.6,7.0,9.4] },
  '90d': { labels:['Jan','Feb','Mar'], rev:[42,48,44], exp:[30,34,32] },
  '1y':  { labels:['Jul','Aug','Sep','Oct','Nov','Dec','Jan','Feb','Mar','Apr','May','Jun'], rev:[28,32,27,35,40,38,42,44,39,48,52,48], exp:[18,22,19,24,28,25,30,32,27,34,38,35] },
};

// =============================================
// NAV
// =============================================
const pages = [
  { id:'dashboard', icon:'layout-dashboard', label:'Dashboard' },
  { id:'analytics', icon:'bar-chart-3', label:'Analytics' },
  { id:'customers', icon:'users', label:'Customers' },
  { id:'orders', icon:'shopping-bag', label:'Orders' },
  { id:'products', icon:'package', label:'Products' },
  { _sep: true, label: 'Settings' },
  { id:'settings', icon:'settings', label:'Settings' },
  { id:'help', icon:'help-circle', label:'Help Center' },
];

function buildSidebar() {
  const nav = document.getElementById('sidebarNav');
  nav.innerHTML = pages.map(p => {
    if (p._sep) return `<div class="pt-4 pb-2"><div class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-4">${p.label}</div></div>`;
    return `<a href="#" class="sidebar-link flex items-center gap-3 px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-100 transition-all duration-200 ${currentPage===p.id?'active':''}" data-page="${p.id}" onclick="event.preventDefault();navigate('${p.id}')">
      <i data-lucide="${p.icon}" class="w-[18px] h-[18px]"></i> ${p.label}
    </a>`;
  }).join('');
  lucide.createIcons();
}

function navigate(page) {
  currentPage = page;
  Object.values(chartInstances).forEach(c => { try{c.destroy()}catch(e){} });
  chartInstances = {};
  buildSidebar();
  const pg = pages.find(p => p.id === page);
  document.getElementById('pageTitle').textContent = pg ? pg.label : 'Dashboard';
  const subtitles = {
    dashboard: getGreeting(), analytics: 'Deep dive into your metrics',
    customers: `${state.customers.length} total customers`, orders: `${state.orders.length} recent orders`,
    products: `${state.products.length} products in catalog`, settings: 'Manage your account',
    help: 'Find answers and get support'
  };
  document.getElementById('pageSubtitle').textContent = subtitles[page] || '';
  const renderers = { dashboard:renderDashboard, analytics:renderAnalytics, customers:renderCustomers, orders:renderOrders, products:renderProducts, settings:renderSettings, help:renderHelp };
  (renderers[page] || renderDashboard)();
  lucide.createIcons();
  window.scrollTo(0,0);
}

function getGreeting() {
  const h = new Date().getHours();
  return (h<12?'Good morning':h<18?'Good afternoon':'Good evening') + "! Here's what's happening today.";
}

// =============================================
// UTILITIES
// =============================================
function $(sel,ctx=document){return ctx.querySelector(sel)}
function $$(sel,ctx=document){return[...ctx.querySelectorAll(sel)]}
function timeAgo(ts){const d=Date.now()-ts,m=Math.floor(d/60000);if(m<1)return 'just now';if(m<60)return m+'m ago';const h=Math.floor(m/60);if(h<24)return h+'h ago';return Math.floor(h/24)+'d ago';}
function closeModal(){document.getElementById('modal').classList.add('hidden')}
function openModal(html){document.getElementById('modalBody').innerHTML=html;document.getElementById('modal').classList.remove('hidden');lucide.createIcons();}
function applyTheme(theme){
  state.settings.theme=theme==='dark'?'dark':'light';
  const isDark=state.settings.theme==='dark';
  document.body.classList.toggle('dark-mode',isDark);
  localStorage.setItem('pulse-theme',state.settings.theme);
  const btn=document.getElementById('themeToggleBtn');
  if(btn){
    btn.title=isDark?'Light mode':'Dark mode';
    btn.setAttribute('aria-label',isDark?'Switch to light mode':'Switch to dark mode');
    const icon=btn.querySelector('i');
    if(icon)icon.setAttribute('data-lucide',isDark?'sun':'moon');
  }
  lucide.createIcons();
}
function toggleTheme(){applyTheme(state.settings.theme==='dark'?'light':'dark')}

function toggleNotifications(){
  const p=document.getElementById('notifPanel');
  p.classList.toggle('translate-x-full');
  if(!p.classList.contains('translate-x-full'))renderNotifPanel();
}
function markAllRead(){
  state.notifications.forEach(n=>n.read=true);
  renderNotifPanel();
  updateNotifBadge();
}
function markNotifRead(id){
  const n=state.notifications.find(x=>x.id===id);
  if(n)n.read=true;
  renderNotifPanel();
  updateNotifBadge();
}
function deleteNotif(id){
  state.notifications=state.notifications.filter(x=>x.id!==id);
  renderNotifPanel();
  updateNotifBadge();
}
function updateNotifBadge(){
  const btn=document.getElementById('notifBellBtn');
  const unread=state.notifications.filter(n=>!n.read).length;
  if(unread>0)btn.classList.add('notification-dot');else btn.classList.remove('notification-dot');
}
function renderNotifPanel(){
  const list=document.getElementById('notifList');
  if(!state.notifications.length){list.innerHTML='<p class="text-sm text-slate-400 text-center py-8">No notifications</p>';return;}
  list.innerHTML=state.notifications.map(n=>`
    <div class="flex gap-3 p-3 rounded-xl ${n.read?'':'bg-vermillion-50/50'} hover:bg-slate-100 transition-colors group">
      <div class="w-10 h-10 rounded-xl ${n.color} flex items-center justify-center flex-shrink-0"><i data-lucide="${n.icon}" class="w-5 h-5"></i></div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2"><p class="text-sm font-semibold text-slate-800">${n.title}</p>${n.read?'':'<div class="w-2 h-2 rounded-full bg-vermillion-500"></div>'}</div>
        <p class="text-xs text-slate-500 mt-0.5">${n.desc}</p>
        <div class="flex items-center gap-3 mt-1.5">
          <span class="text-xs text-slate-400">${timeAgo(n.time)}</span>
          ${n.read?'':`<button onclick="markNotifRead(${n.id})" class="text-xs text-vermillion-600 font-medium hover:underline">Mark read</button>`}
          <button onclick="deleteNotif(${n.id})" class="text-xs text-red-500 font-medium hover:underline opacity-0 group-hover:opacity-100 transition-opacity">Delete</button>
        </div>
      </div>
    </div>
  `).join('');
  lucide.createIcons();
}

function doExport(){
  let csv='';
  if(currentPage==='customers'){
    csv='Name,Email,Phone,City,Total Spent,Orders,Status,Joined\n';
    state.customers.forEach(c=>{csv+=`"${c.name}","${c.email}","${c.phone}","${c.city}",${c.spent},${c.orders},"${c.status}","${c.joined}"\n`;});
  } else if(currentPage==='orders'){
    csv='Order ID,Customer,Items,Total,Status,Date\n';
    state.orders.forEach(o=>{csv+=`"${o.id}","${o.customer}","${o.items.join('; ')}",${o.total},"${o.status}","${o.date}"\n`;});
  } else if(currentPage==='products'){
    csv='Name,Price,Category,Status,Sales\n';
    state.products.forEach(p=>{csv+=`"${p.name}",${p.price},"${p.category}","${p.status}",${p.sales}\n`;});
  } else {
    csv='Metric,Value\nTotal Revenue,$48352\nActive Users,2841\nConversion Rate,3.24%\nAvg Session,4m 32s\n';
  }
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`pulse-${currentPage}-export.csv`;a.click();
}

function handleGlobalSearch(val){
  const dd=document.getElementById('searchDropdown');
  if(!val.trim()){dd.classList.add('hidden');return;}
  const v=val.toLowerCase();
  const pageMatches=pages.filter(p=>p.id&&p.label.toLowerCase().includes(v));
  const custMatches=state.customers.filter(c=>c.name.toLowerCase().includes(v)||c.email.toLowerCase().includes(v));
  const orderMatches=state.orders.filter(o=>o.id.toLowerCase().includes(v)||o.customer.toLowerCase().includes(v));
  if(!pageMatches.length&&!custMatches.length&&!orderMatches.length){dd.classList.add('hidden');return;}
  dd.classList.remove('hidden');
  let html='';
  if(pageMatches.length){
    html+='<div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase bg-slate-50">Pages</div>';
    html+=pageMatches.map(p=>`<div class="px-4 py-3 hover:bg-vermillion-50 cursor-pointer text-sm text-slate-700 flex items-center gap-2 transition-colors" onclick="navigate('${p.id}');document.getElementById('searchDropdown').classList.add('hidden');document.getElementById('globalSearch').value=''"><i data-lucide="${p.icon}" class="w-4 h-4 text-slate-400"></i>${p.label}</div>`).join('');
  }
  if(custMatches.length){
    html+='<div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase bg-slate-50">Customers</div>';
    html+=custMatches.map(c=>`<div class="px-4 py-3 hover:bg-vermillion-50 cursor-pointer text-sm flex items-center gap-3 transition-colors" onclick="navigate('customers');setTimeout(()=>openCustomerDetail(${c.id}),100);document.getElementById('searchDropdown').classList.add('hidden');document.getElementById('globalSearch').value=''"><div class="w-7 h-7 rounded-lg bg-gradient-to-br ${c.color} flex items-center justify-center text-white text-[10px] font-bold">${c.avatar}</div><div><div class="font-medium text-slate-700">${c.name}</div><div class="text-xs text-slate-400">${c.email}</div></div></div>`).join('');
  }
  if(orderMatches.length){
    html+='<div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase bg-slate-50">Orders</div>';
    html+=orderMatches.map(o=>`<div class="px-4 py-3 hover:bg-vermillion-50 cursor-pointer text-sm text-slate-700 flex items-center gap-2 transition-colors" onclick="navigate('orders');setTimeout(()=>openOrderDetail('${o.id}'),100);document.getElementById('searchDropdown').classList.add('hidden');document.getElementById('globalSearch').value=''"><i data-lucide="shopping-bag" class="w-4 h-4 text-slate-400"></i>${o.id} - ${o.customer}</div>`).join('');
  }
  dd.innerHTML=html;
  lucide.createIcons();
}

document.addEventListener('click',e=>{if(!e.target.closest('#globalSearch')&&!e.target.closest('#searchDropdown'))document.getElementById('searchDropdown').classList.add('hidden')});
document.addEventListener('keydown',e=>{
  if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();document.getElementById('globalSearch').focus();}
  if(e.key==='Escape'){closeModal();document.getElementById('notifPanel').classList.add('translate-x-full');document.getElementById('searchDropdown').classList.add('hidden');}
});

// =============================================
// DASHBOARD PAGE
// =============================================
function renderDashboard(){
  const pc=document.getElementById('pageContent');
  pc.innerHTML=`
    <!-- KPI Cards -->
    <div class="grid grid-cols-4 gap-6 mb-8">
      ${kpiCard('revenue','Total Revenue','$48,352','+12.5%',true,'dollar-sign','grad-1','shadow-vermillion-200/50','vermillion',78,'78% of monthly goal')}
      ${kpiCard('users','Active Users','2,841','+8.1%',true,'users','grad-2','shadow-pink-200/50','pink',64,'64% of target users')}
      ${kpiCard('conversion','Conversion Rate','3.24%','-0.4%',false,'mouse-pointer-click','grad-3','shadow-cyan-200/50','cyan',54,'54% of industry avg')}
      ${kpiCard('session','Avg. Session','4m 32s','+1.2%',true,'clock','grad-4','shadow-emerald-200/50','emerald',72,'72% engagement rate')}
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-3 gap-6 mb-8">
      <div class="col-span-2 bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:200ms">
        <div class="flex items-center justify-between mb-6">
          <div><h2 class="text-lg font-bold text-slate-800">Revenue Overview</h2><p class="text-sm text-slate-500">Revenue vs expenses</p></div>
          <div class="flex items-center gap-3">
            <div class="flex bg-slate-100 rounded-xl p-1" id="chartTabs">
              <button onclick="switchDashChart('bar')" class="chart-tab px-4 py-1.5 rounded-lg text-xs font-semibold tab-active transition-all" data-tab="bar">Bar</button>
              <button onclick="switchDashChart('line')" class="chart-tab px-4 py-1.5 rounded-lg text-xs font-semibold text-slate-500 hover:text-slate-700 transition-all" data-tab="line">Line</button>
            </div>
            <div class="flex bg-slate-100 rounded-xl p-1" id="dateRangeTabs">
              ${dateRanges.map(r=>`<button onclick="switchDateRange('${r}')" class="dr-tab px-3 py-1.5 rounded-lg text-xs font-semibold ${activeDateRange===r?'tab-active':'text-slate-500 hover:text-slate-700'} transition-all" data-range="${r}">${r}</button>`).join('')}
            </div>
          </div>
        </div>
        <div style="height:280px"><canvas id="dashMainChart"></canvas></div>
      </div>
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:300ms">
        <div class="flex items-center justify-between mb-6">
          <div><h2 class="text-lg font-bold text-slate-800">Traffic Sources</h2><p class="text-sm text-slate-500">Where visitors come from</p></div>
        </div>
        <div style="height:190px" class="mb-4"><canvas id="dashDoughnut"></canvas></div>
        <div class="space-y-3" id="trafficLegend"></div>
      </div>
    </div>

    <!-- Table + Activity -->
    <div class="grid grid-cols-3 gap-6">
      <div class="col-span-2 bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden animate-slide-up" style="animation-delay:400ms">
        <div class="flex items-center justify-between p-6 pb-4">
          <div><h2 class="text-lg font-bold text-slate-800">Recent Transactions</h2><p class="text-sm text-slate-500">Latest orders</p></div>
          <button onclick="navigate('orders')" class="text-sm text-vermillion-600 font-semibold hover:underline">View all</button>
        </div>
        <table class="w-full"><thead><tr class="border-t border-b border-slate-100">
          <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Order</th>
          <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Customer</th>
          <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Amount</th>
          <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Status</th>
          <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Date</th>
        </tr></thead><tbody id="dashOrdersTable"></tbody></table>
      </div>
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:500ms">
        <h2 class="text-lg font-bold text-slate-800 mb-5">Activity</h2>
        <div class="space-y-4" id="dashActivity"></div>
      </div>
    </div>
  `;
  lucide.createIcons();
  buildDashChart('bar');
  buildDoughnut();
  buildDashOrdersTable();
  buildDashActivity();
  startLiveMetrics();
}

function kpiCard(id,label,value,change,up,icon,grad,shadow,hoverColor,pct,pctLabel){
  return `<div onclick="openKpiDetail('${id}')" class="cursor-pointer bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-lg hover:border-${hoverColor}-200 transition-all duration-300 animate-slide-up">
    <div class="flex items-center justify-between mb-4">
      <div class="w-12 h-12 rounded-2xl ${grad} flex items-center justify-center shadow-lg ${shadow}"><i data-lucide="${icon}" class="w-6 h-6 text-white"></i></div>
      <span class="flex items-center gap-1 ${up?'text-emerald-600 bg-emerald-50':'text-red-500 bg-red-50'} px-2.5 py-1 rounded-lg text-xs font-semibold"><i data-lucide="${up?'trending-up':'trending-down'}" class="w-3 h-3"></i> ${change}</span>
    </div>
    <div class="text-sm font-medium text-slate-500 mb-1">${label}</div>
    <div class="text-3xl font-bold text-slate-800 tracking-tight" id="kpi_${id}">${value}</div>
    <div class="mt-3 h-1.5 bg-slate-100 rounded-full overflow-hidden"><div class="h-full ${grad} rounded-full" style="width:${pct}%"></div></div>
    <div class="text-xs text-slate-400 mt-2">${pctLabel}</div>
  </div>`;
}

function openKpiDetail(type){
  const d={
    revenue:{title:'Revenue Breakdown',grad:'grad-1',icon:'dollar-sign',items:[['Product Sales','$32,180'],['Subscriptions','$12,450'],['Services','$3,722']]},
    users:{title:'User Analytics',grad:'grad-2',icon:'users',items:[['New Users','423'],['Returning','1,892'],['Active Now','526']]},
    conversion:{title:'Conversion Funnel',grad:'grad-3',icon:'mouse-pointer-click',items:[['Page Views','45,821'],['Add to Cart','3,245'],['Purchases','1,484']]},
    session:{title:'Session Details',grad:'grad-4',icon:'clock',items:[['Avg Pages/Session','4.7'],['Bounce Rate','32%'],['Session Duration','4m 32s']]},
  }[type];
  openModal(`
    <div class="flex items-center gap-4 mb-6">
      <div class="w-14 h-14 rounded-2xl ${d.grad} flex items-center justify-center shadow-lg"><i data-lucide="${d.icon}" class="w-7 h-7 text-white"></i></div>
      <div><h3 class="text-xl font-bold text-slate-800">${d.title}</h3><p class="text-sm text-slate-500">Detailed breakdown</p></div>
      <button onclick="closeModal()" class="ml-auto p-2 rounded-xl hover:bg-slate-100"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button>
    </div>
    <div class="space-y-3">${d.items.map(([l,v])=>`<div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl"><span class="text-sm font-medium text-slate-600">${l}</span><span class="text-lg font-bold text-slate-800">${v}</span></div>`).join('')}</div>
    <button onclick="closeModal();navigate('analytics')" class="w-full mt-6 py-3 bg-vermillion-600 text-white rounded-xl font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">View Full Analytics</button>
  `);
}

let dashChartType='bar';
function switchDashChart(type){
  dashChartType=type;
  $$('.chart-tab').forEach(t=>{t.classList.toggle('tab-active',t.dataset.tab===type);t.classList.toggle('text-slate-500',t.dataset.tab!==type)});
  buildDashChart(type);
}
function switchDateRange(range){
  activeDateRange=range;
  $$('.dr-tab').forEach(t=>{t.classList.toggle('tab-active',t.dataset.range===range);t.classList.toggle('text-slate-500',t.dataset.range!==range)});
  buildDashChart(dashChartType);
}

function buildDashChart(type){
  if(chartInstances.dashMain)chartInstances.dashMain.destroy();
  const r=revenueByRange[activeDateRange];
  chartInstances.dashMain=new Chart(document.getElementById('dashMainChart'),{
    type:type,
    data:{labels:r.labels,datasets:[
      {label:'Revenue',data:r.rev,backgroundColor:'#3b82f6',borderColor:'#3b82f6',borderRadius:type==='bar'?8:0,borderSkipped:false,barPercentage:0.6,categoryPercentage:0.7,fill:type==='line',tension:0.4,pointRadius:type==='line'?4:0,pointBackgroundColor:'#3b82f6'},
      {label:'Expenses',data:r.exp,backgroundColor:type==='bar'?'#dbeafe':'rgba(59,130,246,0.12)',borderColor:'#93c5fd',borderRadius:type==='bar'?8:0,borderSkipped:false,barPercentage:0.6,categoryPercentage:0.7,fill:type==='line',tension:0.4,pointRadius:type==='line'?4:0,pointBackgroundColor:'#93c5fd',borderDash:type==='line'?[5,5]:[]}
    ]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:true,position:'top',align:'end',labels:{usePointStyle:true,pointStyle:'rectRounded',padding:20,font:{size:12,weight:'500'},color:'#64748b'}},tooltip:{backgroundColor:'#1e293b',padding:12,cornerRadius:10}},scales:{x:{ticks:{color:'#94a3b8'},grid:{display:false},border:{display:false}},y:{ticks:{color:'#94a3b8',callback:v=>'$'+v+'k'},grid:{color:'#f1f5f9'},border:{display:false}}}}
  });
}

function buildDoughnut(){
  const td=[{l:'Direct',v:35,c:'#3b82f6'},{l:'Organic',v:30,c:'#10b981'},{l:'Referral',v:20,c:'#60a5fa'},{l:'Social',v:15,c:'#f59e0b'}];
  chartInstances.dashDoughnut=new Chart(document.getElementById('dashDoughnut'),{
    type:'doughnut',data:{labels:td.map(t=>t.l),datasets:[{data:td.map(t=>t.v),backgroundColor:td.map(t=>t.c),borderWidth:0,hoverOffset:8}]},
    options:{responsive:true,maintainAspectRatio:false,cutout:'72%',plugins:{legend:{display:false},tooltip:{backgroundColor:'#1e293b',padding:12,cornerRadius:10,callbacks:{label:c=>` ${c.label}: ${c.raw}%`}}}}
  });
  document.getElementById('trafficLegend').innerHTML=td.map(t=>`<div class="flex items-center justify-between"><div class="flex items-center gap-2.5"><div class="w-3 h-3 rounded-full" style="background:${t.c}"></div><span class="text-sm text-slate-600">${t.l}</span></div><span class="text-sm font-semibold text-slate-800">${t.v}%</span></div>`).join('');
}

function buildDashOrdersTable(){
  document.getElementById('dashOrdersTable').innerHTML=state.orders.slice(0,5).map(o=>`
    <tr class="hover:bg-slate-50 cursor-pointer transition-colors" onclick="navigate('orders');setTimeout(()=>openOrderDetail('${o.id}'),100)">
      <td class="px-6 py-4 text-sm font-semibold text-vermillion-600">${o.id}</td>
      <td class="px-6 py-4 text-sm text-slate-700">${o.customer}</td>
      <td class="px-6 py-4 text-sm font-semibold text-slate-800">$${o.total.toLocaleString()}</td>
      <td class="px-6 py-4">${statusBadge(o.status)}</td>
      <td class="px-6 py-4 text-sm text-slate-500">${o.date}</td>
    </tr>`).join('');
}

function buildDashActivity(){
  const acts=[
    {icon:'user-plus',color:'bg-vermillion-100 text-vermillion-600',text:'<b>Sarah Kim</b> signed up',time:'2 min ago'},
    {icon:'credit-card',color:'bg-emerald-100 text-emerald-600',text:'Payment of <b>$1,247</b> received',time:'15 min ago'},
    {icon:'package',color:'bg-amber-100 text-amber-600',text:'Order <b>#4821</b> shipped',time:'1 hour ago'},
    {icon:'star',color:'bg-pink-100 text-pink-600',text:'5-star review from <b>James</b>',time:'2 hours ago'},
    {icon:'check-circle',color:'bg-teal-100 text-teal-600',text:'Deploy <b>v2.4.1</b> successful',time:'5 hours ago'},
  ];
  document.getElementById('dashActivity').innerHTML=acts.map((a,i)=>`
    <div class="flex gap-3 animate-slide-right" style="animation-delay:${i*60}ms">
      <div class="w-9 h-9 rounded-xl ${a.color} flex items-center justify-center flex-shrink-0"><i data-lucide="${a.icon}" class="w-4 h-4"></i></div>
      <div><p class="text-sm text-slate-700">${a.text}</p><p class="text-xs text-slate-400 mt-1">${a.time}</p></div>
    </div>`).join('');
  lucide.createIcons();
}

let metricsInterval;
function startLiveMetrics(){
  clearInterval(metricsInterval);
  let rev=48352,usr=2841,conv=3.24,sess=272;
  metricsInterval=setInterval(()=>{
    const el=id=>document.getElementById('kpi_'+id);
    if(!el('revenue'))return clearInterval(metricsInterval);
    rev=Math.max(0,rev+(Math.random()-0.45)*rev*0.01);el('revenue').textContent='$'+Math.round(rev).toLocaleString();
    usr=Math.max(0,usr+(Math.random()-0.45)*usr*0.01);el('users').textContent=Math.round(usr).toLocaleString();
    conv=Math.max(0,conv+(Math.random()-0.45)*conv*0.01);el('conversion').textContent=conv.toFixed(2)+'%';
    sess=Math.max(60,sess+(Math.random()-0.45)*sess*0.01);el('session').textContent=Math.floor(sess/60)+'m '+Math.floor(sess%60)+'s';
  },3000);
}

function statusBadge(s){
  const m={completed:'bg-emerald-50 text-emerald-700 ring-emerald-600/10',delivered:'bg-emerald-50 text-emerald-700 ring-emerald-600/10',shipped:'bg-blue-50 text-blue-700 ring-blue-600/10',processing:'bg-amber-50 text-amber-700 ring-amber-600/10',pending:'bg-slate-100 text-slate-600 ring-slate-500/10',cancelled:'bg-red-50 text-red-700 ring-red-600/10',failed:'bg-red-50 text-red-700 ring-red-600/10',active:'bg-emerald-50 text-emerald-700 ring-emerald-600/10',inactive:'bg-slate-100 text-slate-600 ring-slate-500/10',vip:'bg-amber-50 text-amber-700 ring-amber-600/10',draft:'bg-slate-100 text-slate-600 ring-slate-500/10'};
  const icons={completed:'check-circle',delivered:'check-circle',shipped:'truck',processing:'loader',pending:'clock',cancelled:'x-circle',failed:'x-circle',active:'check-circle',inactive:'pause-circle',vip:'crown',draft:'file-edit'};
  return `<span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg text-xs font-semibold ring-1 ring-inset ${m[s]||'bg-slate-100 text-slate-600'}"><i data-lucide="${icons[s]||'circle'}" class="w-3 h-3"></i>${s.charAt(0).toUpperCase()+s.slice(1)}</span>`;
}

// =============================================
// ANALYTICS PAGE
// =============================================
function renderAnalytics(){
  const pc=document.getElementById('pageContent');
  pc.innerHTML=`
    <div class="grid grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-2xl p-5 border border-slate-200/60 shadow-sm animate-slide-up"><div class="text-sm text-slate-500 mb-1">Page Views</div><div class="text-2xl font-bold text-slate-800">128,430</div><div class="text-xs text-emerald-600 mt-1">+14.2% vs last period</div></div>
      <div class="bg-white rounded-2xl p-5 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:50ms"><div class="text-sm text-slate-500 mb-1">Unique Visitors</div><div class="text-2xl font-bold text-slate-800">45,291</div><div class="text-xs text-emerald-600 mt-1">+9.8% vs last period</div></div>
      <div class="bg-white rounded-2xl p-5 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:100ms"><div class="text-sm text-slate-500 mb-1">Bounce Rate</div><div class="text-2xl font-bold text-slate-800">32.1%</div><div class="text-xs text-red-500 mt-1">+2.1% vs last period</div></div>
      <div class="bg-white rounded-2xl p-5 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:150ms"><div class="text-sm text-slate-500 mb-1">Avg. Time on Page</div><div class="text-2xl font-bold text-slate-800">2m 48s</div><div class="text-xs text-emerald-600 mt-1">+5.3% vs last period</div></div>
    </div>
    <div class="grid grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:200ms">
        <h2 class="text-lg font-bold text-slate-800 mb-1">Visitors Trend</h2><p class="text-sm text-slate-500 mb-4">Daily unique visitors over 30 days</p>
        <div style="height:260px"><canvas id="analyticsVisitors"></canvas></div>
      </div>
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:300ms">
        <h2 class="text-lg font-bold text-slate-800 mb-1">Revenue by Channel</h2><p class="text-sm text-slate-500 mb-4">Breakdown of revenue sources</p>
        <div style="height:260px"><canvas id="analyticsChannels"></canvas></div>
      </div>
    </div>
    <div class="grid grid-cols-3 gap-6">
      <div class="col-span-2 bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:400ms">
        <h2 class="text-lg font-bold text-slate-800 mb-4">Top Pages</h2>
        <table class="w-full"><thead><tr class="border-b border-slate-100">
          <th class="text-left py-3 px-4 text-xs font-semibold text-slate-500 uppercase">Page</th>
          <th class="text-left py-3 px-4 text-xs font-semibold text-slate-500 uppercase">Views</th>
          <th class="text-left py-3 px-4 text-xs font-semibold text-slate-500 uppercase">Uniques</th>
          <th class="text-left py-3 px-4 text-xs font-semibold text-slate-500 uppercase">Bounce</th>
          <th class="text-left py-3 px-4 text-xs font-semibold text-slate-500 uppercase">Avg Time</th>
        </tr></thead><tbody>
          ${[['/',42180,28430,'28%','3m 12s'],
             ['/pricing',18920,14210,'35%','2m 45s'],
             ['/features',12450,9870,'22%','4m 01s'],
             ['/blog',8930,7120,'41%','1m 38s'],
             ['/docs',6840,5230,'18%','5m 22s'],
             ['/about',4210,3580,'44%','1m 15s'],
          ].map(([p,v,u,b,t])=>`<tr class="border-b border-slate-50 hover:bg-slate-50 transition-colors"><td class="py-3 px-4 text-sm font-medium text-vermillion-600">${p}</td><td class="py-3 px-4 text-sm text-slate-700">${v.toLocaleString()}</td><td class="py-3 px-4 text-sm text-slate-700">${u.toLocaleString()}</td><td class="py-3 px-4 text-sm text-slate-700">${b}</td><td class="py-3 px-4 text-sm text-slate-700">${t}</td></tr>`).join('')}
        </tbody></table>
      </div>
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:500ms">
        <h2 class="text-lg font-bold text-slate-800 mb-1">Device Breakdown</h2><p class="text-sm text-slate-500 mb-4">By device type</p>
        <div style="height:200px"><canvas id="analyticsDevices"></canvas></div>
        <div class="space-y-3 mt-4">
          ${[['Desktop','62%','#3b82f6'],['Mobile','28%','#10b981'],['Tablet','10%','#f59e0b']].map(([l,v,c])=>`<div class="flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full" style="background:${c}"></div><span class="text-sm text-slate-600">${l}</span></div><span class="text-sm font-semibold text-slate-800">${v}</span></div>`).join('')}
        </div>
      </div>
    </div>`;
  lucide.createIcons();
  // Visitors chart
  const days=Array.from({length:30},(_,i)=>i+1);
  const visitors=days.map(()=>Math.floor(800+Math.random()*900));
  chartInstances.visitors=new Chart(document.getElementById('analyticsVisitors'),{type:'line',data:{labels:days.map(d=>'Day '+d),datasets:[{label:'Visitors',data:visitors,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.1)',fill:true,tension:0.4,pointRadius:0,pointHitRadius:10}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{backgroundColor:'#1e293b',padding:12,cornerRadius:10}},scales:{x:{ticks:{color:'#94a3b8',maxTicksLimit:10},grid:{display:false},border:{display:false}},y:{ticks:{color:'#94a3b8'},grid:{color:'#f1f5f9'},border:{display:false}}}}});
  // Channels
  chartInstances.channels=new Chart(document.getElementById('analyticsChannels'),{type:'bar',data:{labels:['Direct','Organic','Paid','Email','Social','Referral'],datasets:[{label:'Revenue ($k)',data:[18.2,14.5,8.9,4.2,2.1,1.5],backgroundColor:['#3b82f6','#10b981','#f59e0b','#ec4899','#60a5fa','#06b6d4'],borderRadius:8,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',plugins:{legend:{display:false},tooltip:{backgroundColor:'#1e293b',padding:12,cornerRadius:10,callbacks:{label:c=>' $'+c.raw+'k'}}},scales:{x:{ticks:{color:'#94a3b8',callback:v=>'$'+v+'k'},grid:{color:'#f1f5f9'},border:{display:false}},y:{ticks:{color:'#64748b',font:{weight:'500'}},grid:{display:false},border:{display:false}}}}});
  // Devices
  chartInstances.devices=new Chart(document.getElementById('analyticsDevices'),{type:'doughnut',data:{labels:['Desktop','Mobile','Tablet'],datasets:[{data:[62,28,10],backgroundColor:['#3b82f6','#10b981','#f59e0b'],borderWidth:0,hoverOffset:6}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{display:false}}}});
}

// =============================================
// CUSTOMERS PAGE
// =============================================
let custSort={field:'name',asc:true}, custFilter='all', custSearch='';
function renderCustomers(){
  const pc=document.getElementById('pageContent');
  pc.innerHTML=`
    <div class="bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden animate-slide-up">
      <div class="flex items-center justify-between p-6">
        <div class="flex items-center gap-3">
          <div class="relative"><i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
          <input type="text" placeholder="Search customers..." class="pl-10 pr-4 py-2 bg-slate-50 rounded-xl text-sm border border-slate-200 focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none w-64" oninput="custSearch=this.value;renderCustTable()" value="${custSearch}"></div>
          <div class="flex bg-slate-100 rounded-xl p-1">
            ${['all','active','inactive','vip'].map(f=>`<button onclick="custFilter='${f}';renderCustTable()" class="cust-filter px-3 py-1 rounded-lg text-xs font-semibold ${custFilter===f?'tab-active':'text-slate-500 hover:text-slate-700'} transition-all" data-f="${f}">${f==='all'?'All':f.charAt(0).toUpperCase()+f.slice(1)}</button>`).join('')}
          </div>
        </div>
        <button onclick="openAddCustomer()" class="flex items-center gap-2 px-4 py-2 bg-vermillion-600 text-white rounded-xl text-sm font-medium hover:bg-vermillion-700 active:scale-95 transition-all"><i data-lucide="plus" class="w-4 h-4"></i> Add Customer</button>
      </div>
      <table class="w-full"><thead><tr class="border-t border-b border-slate-100">
        <th onclick="toggleCustSort('name')" class="cursor-pointer hover:bg-slate-50 text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider"><span class="flex items-center gap-1">Customer <i data-lucide="arrow-up-down" class="w-3 h-3"></i></span></th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Contact</th>
        <th onclick="toggleCustSort('spent')" class="cursor-pointer hover:bg-slate-50 text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider"><span class="flex items-center gap-1">Spent <i data-lucide="arrow-up-down" class="w-3 h-3"></i></span></th>
        <th onclick="toggleCustSort('orders')" class="cursor-pointer hover:bg-slate-50 text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider"><span class="flex items-center gap-1">Orders <i data-lucide="arrow-up-down" class="w-3 h-3"></i></span></th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Status</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Joined</th>
        <th class="px-6 py-3"></th>
      </tr></thead><tbody id="custTableBody"></tbody></table>
    </div>`;
  lucide.createIcons();
  renderCustTable();
}
function toggleCustSort(f){if(custSort.field===f)custSort.asc=!custSort.asc;else{custSort.field=f;custSort.asc=true;}renderCustTable();}
function renderCustTable(){
  let data=[...state.customers];
  if(custFilter!=='all')data=data.filter(c=>c.status===custFilter);
  if(custSearch)data=data.filter(c=>c.name.toLowerCase().includes(custSearch.toLowerCase())||c.email.toLowerCase().includes(custSearch.toLowerCase()));
  const sf=custSort.field;
  data.sort((a,b)=>{let r=typeof a[sf]==='string'?a[sf].localeCompare(b[sf]):a[sf]-b[sf];return custSort.asc?r:-r;});
  const tb=document.getElementById('custTableBody');
  tb.innerHTML=data.map(c=>`
    <tr class="hover:bg-slate-50 transition-colors cursor-pointer group" onclick="openCustomerDetail(${c.id})">
      <td class="px-6 py-4"><div class="flex items-center gap-3"><div class="w-9 h-9 rounded-xl bg-gradient-to-br ${c.color} flex items-center justify-center text-white text-xs font-bold shadow-sm">${c.avatar}</div><span class="text-sm font-semibold text-slate-800">${c.name}</span></div></td>
      <td class="px-6 py-4"><div class="text-sm text-slate-600">${c.email}</div><div class="text-xs text-slate-400">${c.phone}</div></td>
      <td class="px-6 py-4 text-sm font-semibold text-slate-800">$${c.spent.toLocaleString()}</td>
      <td class="px-6 py-4 text-sm text-slate-700">${c.orders}</td>
      <td class="px-6 py-4">${statusBadge(c.status)}</td>
      <td class="px-6 py-4 text-sm text-slate-500">${c.joined}</td>
      <td class="px-6 py-4"><button onclick="event.stopPropagation();confirmDeleteCustomer(${c.id})" class="opacity-0 group-hover:opacity-100 p-1 rounded-lg hover:bg-red-50 transition-all"><i data-lucide="trash-2" class="w-4 h-4 text-red-400"></i></button></td>
    </tr>`).join('');
  if(!data.length)tb.innerHTML='<tr><td colspan="7" class="px-6 py-12 text-center text-slate-400">No customers found</td></tr>';
  lucide.createIcons();
}
function openCustomerDetail(id){
  const c=state.customers.find(x=>x.id===id);if(!c)return;
  const orders=state.orders.filter(o=>o.customer===c.name);
  openModal(`
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br ${c.color} flex items-center justify-center text-white text-xl font-bold shadow-lg">${c.avatar}</div>
        <div><h3 class="text-xl font-bold text-slate-800">${c.name}</h3><p class="text-sm text-slate-500">${c.email}</p></div>
      </div>
      <button onclick="closeModal()" class="p-2 rounded-xl hover:bg-slate-100"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button>
    </div>
    <div class="grid grid-cols-2 gap-3 mb-4">
      <div class="p-4 bg-slate-50 rounded-xl"><span class="text-xs text-slate-500">Phone</span><div class="text-sm font-semibold text-slate-800 mt-0.5">${c.phone}</div></div>
      <div class="p-4 bg-slate-50 rounded-xl"><span class="text-xs text-slate-500">City</span><div class="text-sm font-semibold text-slate-800 mt-0.5">${c.city}</div></div>
      <div class="p-4 bg-slate-50 rounded-xl"><span class="text-xs text-slate-500">Total Spent</span><div class="text-sm font-semibold text-slate-800 mt-0.5">$${c.spent.toLocaleString()}</div></div>
      <div class="p-4 bg-slate-50 rounded-xl"><span class="text-xs text-slate-500">Orders</span><div class="text-sm font-semibold text-slate-800 mt-0.5">${c.orders}</div></div>
    </div>
    <div class="flex items-center gap-2 mb-3"><span class="text-xs text-slate-500">Status:</span>${statusBadge(c.status)}<span class="text-xs text-slate-500 ml-auto">Joined ${c.joined}</span></div>
    ${orders.length?`<h4 class="text-sm font-bold text-slate-700 mt-4 mb-2">Recent Orders</h4><div class="space-y-2">${orders.map(o=>`<div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl"><div><span class="text-sm font-semibold text-vermillion-600">${o.id}</span><span class="text-sm text-slate-500 ml-2">$${o.total}</span></div>${statusBadge(o.status)}</div>`).join('')}</div>`:''}
    <div class="flex gap-3 mt-6">
      <button onclick="closeModal();navigate('orders')" class="flex-1 py-2.5 bg-vermillion-600 text-white rounded-xl text-sm font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">View Orders</button>
      <button onclick="closeModal()" class="flex-1 py-2.5 bg-slate-100 text-slate-700 rounded-xl text-sm font-semibold hover:bg-slate-200 active:scale-[0.98] transition-all">Close</button>
    </div>`);
}
function openAddCustomer(){
  openModal(`
    <div class="flex items-center justify-between mb-6"><h3 class="text-xl font-bold text-slate-800">Add Customer</h3><button onclick="closeModal()" class="p-2 rounded-xl hover:bg-slate-100"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button></div>
    <form onsubmit="event.preventDefault();addCustomer(this)" class="space-y-4">
      <div><label class="text-sm font-medium text-slate-700">Name</label><input name="name" required class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
      <div><label class="text-sm font-medium text-slate-700">Email</label><input name="email" type="email" required class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
      <div class="grid grid-cols-2 gap-3">
        <div><label class="text-sm font-medium text-slate-700">Phone</label><input name="phone" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
        <div><label class="text-sm font-medium text-slate-700">City</label><input name="city" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
      </div>
      <button type="submit" class="w-full py-3 bg-vermillion-600 text-white rounded-xl font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">Add Customer</button>
    </form>`);
}
function addCustomer(form){
  const fd=new FormData(form);const name=fd.get('name');
  state.customers.push({id:Date.now(),name,email:fd.get('email'),spent:0,orders:0,status:'active',joined:new Date().toISOString().slice(0,10),avatar:name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase(),color:'from-vermillion-400 to-vermillion-600',phone:fd.get('phone')||'N/A',city:fd.get('city')||'N/A'});
  closeModal();renderCustomers();
}
function confirmDeleteCustomer(id){
  const c=state.customers.find(x=>x.id===id);
  openModal(`<div class="text-center py-4"><div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4"><i data-lucide="trash-2" class="w-8 h-8 text-red-500"></i></div><h3 class="text-xl font-bold text-slate-800 mb-2">Delete Customer</h3><p class="text-sm text-slate-500 mb-6">Are you sure you want to delete <b>${c.name}</b>? This action cannot be undone.</p><div class="flex gap-3"><button onclick="closeModal()" class="flex-1 py-2.5 bg-slate-100 text-slate-700 rounded-xl text-sm font-semibold hover:bg-slate-200 transition-all">Cancel</button><button onclick="state.customers=state.customers.filter(x=>x.id!==${id});closeModal();renderCustomers()" class="flex-1 py-2.5 bg-red-600 text-white rounded-xl text-sm font-semibold hover:bg-red-700 transition-all">Delete</button></div></div>`);
}

// =============================================
// ORDERS PAGE
// =============================================
let orderFilter='all';
function renderOrders(){
  const pc=document.getElementById('pageContent');
  const counts={all:state.orders.length};
  state.orders.forEach(o=>{counts[o.status]=(counts[o.status]||0)+1;});
  pc.innerHTML=`
    <div class="grid grid-cols-5 gap-4 mb-6">
      ${[['all','All Orders',state.orders.length,'layers'],['pending','Pending',counts.pending||0,'clock'],['processing','Processing',counts.processing||0,'loader'],['shipped','Shipped',counts.shipped||0,'truck'],['delivered','Delivered',counts.delivered||0,'check-circle']].map(([f,l,c,ic])=>`
        <div onclick="orderFilter='${f}';renderOrderTable()" class="cursor-pointer bg-white rounded-2xl p-4 border ${orderFilter===f?'border-vermillion-300 ring-2 ring-vermillion-100':'border-slate-200/60'} shadow-sm hover:shadow-md transition-all">
          <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl ${orderFilter===f?'bg-vermillion-100 text-vermillion-600':'bg-slate-100 text-slate-500'} flex items-center justify-center"><i data-lucide="${ic}" class="w-5 h-5"></i></div><div><div class="text-2xl font-bold text-slate-800">${c}</div><div class="text-xs text-slate-500">${l}</div></div></div>
        </div>`).join('')}
    </div>
    <div class="bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden animate-slide-up">
      <table class="w-full"><thead><tr class="border-b border-slate-100">
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Order ID</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Customer</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Items</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Total</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Status</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Date</th>
      </tr></thead><tbody id="orderTableBody"></tbody></table>
    </div>`;
  lucide.createIcons();
  renderOrderTable();
}
function renderOrderTable(){
  let data=orderFilter==='all'?[...state.orders]:state.orders.filter(o=>o.status===orderFilter);
  document.getElementById('orderTableBody').innerHTML=data.map(o=>`
    <tr class="hover:bg-slate-50 cursor-pointer transition-colors border-b border-slate-50" onclick="openOrderDetail('${o.id}')">
      <td class="px-6 py-4 text-sm font-semibold text-vermillion-600">${o.id}</td>
      <td class="px-6 py-4 text-sm text-slate-700">${o.customer}</td>
      <td class="px-6 py-4 text-sm text-slate-500">${o.items.join(', ')}</td>
      <td class="px-6 py-4 text-sm font-semibold text-slate-800">$${o.total.toLocaleString()}</td>
      <td class="px-6 py-4">${statusBadge(o.status)}</td>
      <td class="px-6 py-4 text-sm text-slate-500">${o.date}</td>
    </tr>`).join('');
  if(!data.length)document.getElementById('orderTableBody').innerHTML='<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">No orders found</td></tr>';
  lucide.createIcons();
}
function openOrderDetail(id){
  const o=state.orders.find(x=>x.id===id);if(!o)return;
  const steps=['pending','processing','shipped','delivered'];
  const ci=steps.indexOf(o.status);
  const cancelled=o.status==='cancelled';
  openModal(`
    <div class="flex items-center justify-between mb-6"><div><h3 class="text-xl font-bold text-slate-800">${o.id}</h3><p class="text-sm text-slate-500">${o.customer}</p></div><button onclick="closeModal()" class="p-2 rounded-xl hover:bg-slate-100"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button></div>
    ${cancelled?'<div class="p-4 bg-red-50 rounded-xl text-sm text-red-700 mb-4 font-medium">This order has been cancelled.</div>':`
    <div class="flex items-center gap-2 mb-6">${steps.map((s,i)=>`<div class="flex-1"><div class="h-2 rounded-full ${i<=ci?'bg-vermillion-500':'bg-slate-200'} transition-all"></div><div class="text-xs mt-1 ${i<=ci?'text-vermillion-600 font-semibold':'text-slate-400'}">${s.charAt(0).toUpperCase()+s.slice(1)}</div></div>`).join('')}</div>`}
    <div class="space-y-3">
      <div class="p-4 bg-slate-50 rounded-xl"><span class="text-xs text-slate-500">Items</span><div class="mt-1 space-y-1">${o.items.map(i=>`<div class="text-sm text-slate-700">- ${i}</div>`).join('')}</div></div>
      <div class="flex justify-between p-4 bg-slate-50 rounded-xl"><span class="text-sm text-slate-500">Total</span><span class="text-lg font-bold text-slate-800">$${o.total.toLocaleString()}</span></div>
      <div class="flex justify-between p-4 bg-slate-50 rounded-xl"><span class="text-sm text-slate-500">Date</span><span class="text-sm font-medium text-slate-800">${o.date}</span></div>
      ${o.tracking?`<div class="flex justify-between p-4 bg-slate-50 rounded-xl"><span class="text-sm text-slate-500">Tracking</span><span class="text-sm font-mono text-slate-800">${o.tracking}</span></div>`:''}
    </div>
    ${!cancelled&&ci<3?`<div class="flex gap-3 mt-6">
      <button onclick="advanceOrder('${o.id}')" class="flex-1 py-2.5 bg-vermillion-600 text-white rounded-xl text-sm font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">Advance to ${steps[ci+1]?steps[ci+1].charAt(0).toUpperCase()+steps[ci+1].slice(1):''}</button>
      <button onclick="cancelOrder('${o.id}')" class="flex-1 py-2.5 bg-red-50 text-red-700 rounded-xl text-sm font-semibold hover:bg-red-100 active:scale-[0.98] transition-all">Cancel Order</button>
    </div>`:'<button onclick="closeModal()" class="w-full mt-6 py-2.5 bg-slate-100 text-slate-700 rounded-xl text-sm font-semibold hover:bg-slate-200 transition-all">Close</button>'}
  `);
}
function advanceOrder(id){
  const o=state.orders.find(x=>x.id===id);
  const steps=['pending','processing','shipped','delivered'];
  const ci=steps.indexOf(o.status);
  if(ci<3){o.status=steps[ci+1];if(o.status==='shipped'&&!o.tracking)o.tracking='1Z999AA1'+Date.now().toString().slice(-8);}
  closeModal();renderOrders();setTimeout(()=>openOrderDetail(id),100);
}
function cancelOrder(id){
  state.orders.find(x=>x.id===id).status='cancelled';
  closeModal();renderOrders();
}

// =============================================
// PRODUCTS PAGE
// =============================================
let prodView='grid';
function renderProducts(){
  const pc=document.getElementById('pageContent');
  pc.innerHTML=`
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="flex bg-slate-100 rounded-xl p-1">
          <button onclick="prodView='grid';renderProductList()" class="px-3 py-1.5 rounded-lg text-xs font-semibold ${prodView==='grid'?'tab-active':'text-slate-500'} transition-all"><i data-lucide="grid-3x3" class="w-4 h-4 inline"></i></button>
          <button onclick="prodView='list';renderProductList()" class="px-3 py-1.5 rounded-lg text-xs font-semibold ${prodView==='list'?'tab-active':'text-slate-500'} transition-all"><i data-lucide="list" class="w-4 h-4 inline"></i></button>
        </div>
        <span class="text-sm text-slate-500">${state.products.length} products</span>
      </div>
      <button onclick="openAddProduct()" class="flex items-center gap-2 px-4 py-2 bg-vermillion-600 text-white rounded-xl text-sm font-medium hover:bg-vermillion-700 active:scale-95 transition-all"><i data-lucide="plus" class="w-4 h-4"></i> Add Product</button>
    </div>
    <div id="productList"></div>`;
  lucide.createIcons();
  renderProductList();
}
function renderProductList(){
  const el=document.getElementById('productList');
  if(prodView==='grid'){
    el.innerHTML=`<div class="grid grid-cols-4 gap-4">${state.products.map(p=>`
      <div class="bg-white rounded-2xl p-5 border border-slate-200/60 shadow-sm hover:shadow-lg hover:border-vermillion-200 transition-all cursor-pointer animate-slide-up" onclick="openProductDetail(${p.id})">
        <div class="w-12 h-12 rounded-2xl bg-vermillion-50 flex items-center justify-center mb-4"><i data-lucide="${p.icon}" class="w-6 h-6 text-vermillion-600"></i></div>
        <h3 class="text-sm font-bold text-slate-800 mb-1">${p.name}</h3>
        <p class="text-xs text-slate-500 mb-3 line-clamp-2">${p.desc}</p>
        <div class="flex items-center justify-between">
          <span class="text-lg font-bold text-slate-800">${p.price===0?'Free':'$'+p.price}</span>
          ${statusBadge(p.status)}
        </div>
        <div class="text-xs text-slate-400 mt-2">${p.sales} sales</div>
      </div>`).join('')}</div>`;
  } else {
    el.innerHTML=`<div class="bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden">
      <table class="w-full"><thead><tr class="border-b border-slate-100">
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Product</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Category</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Price</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Sales</th>
        <th class="text-left px-6 py-3 text-xs font-semibold text-slate-500 uppercase">Status</th>
      </tr></thead><tbody>${state.products.map(p=>`
        <tr class="hover:bg-slate-50 cursor-pointer transition-colors border-b border-slate-50" onclick="openProductDetail(${p.id})">
          <td class="px-6 py-4"><div class="flex items-center gap-3"><div class="w-9 h-9 rounded-xl bg-vermillion-50 flex items-center justify-center"><i data-lucide="${p.icon}" class="w-4 h-4 text-vermillion-600"></i></div><div><div class="text-sm font-semibold text-slate-800">${p.name}</div><div class="text-xs text-slate-400">${p.desc}</div></div></div></td>
          <td class="px-6 py-4 text-sm text-slate-600">${p.category}</td>
          <td class="px-6 py-4 text-sm font-semibold text-slate-800">${p.price===0?'Free':'$'+p.price}</td>
          <td class="px-6 py-4 text-sm text-slate-700">${p.sales}</td>
          <td class="px-6 py-4">${statusBadge(p.status)}</td>
        </tr>`).join('')}</tbody></table></div>`;
  }
  lucide.createIcons();
}
function openProductDetail(id){
  const p=state.products.find(x=>x.id===id);if(!p)return;
  openModal(`
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4"><div class="w-14 h-14 rounded-2xl bg-vermillion-50 flex items-center justify-center"><i data-lucide="${p.icon}" class="w-7 h-7 text-vermillion-600"></i></div><div><h3 class="text-xl font-bold text-slate-800">${p.name}</h3><p class="text-sm text-slate-500">${p.category}</p></div></div>
      <button onclick="closeModal()" class="p-2 rounded-xl hover:bg-slate-100"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button>
    </div>
    <p class="text-sm text-slate-600 mb-4">${p.desc}</p>
    <form onsubmit="event.preventDefault();saveProduct(${p.id},this)" class="space-y-3">
      <div class="grid grid-cols-2 gap-3">
        <div><label class="text-xs font-medium text-slate-500">Price ($)</label><input name="price" type="number" value="${p.price}" min="0" class="w-full mt-1 px-3 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
        <div><label class="text-xs font-medium text-slate-500">Status</label><select name="status" class="w-full mt-1 px-3 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"><option value="active" ${p.status==='active'?'selected':''}>Active</option><option value="draft" ${p.status==='draft'?'selected':''}>Draft</option></select></div>
      </div>
      <div><label class="text-xs font-medium text-slate-500">Description</label><textarea name="desc" class="w-full mt-1 px-3 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none h-20">${p.desc}</textarea></div>
      <div class="flex gap-3">
        <button type="submit" class="flex-1 py-2.5 bg-vermillion-600 text-white rounded-xl text-sm font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">Save Changes</button>
        <button type="button" onclick="confirmDeleteProduct(${p.id})" class="py-2.5 px-4 bg-red-50 text-red-700 rounded-xl text-sm font-semibold hover:bg-red-100 transition-all">Delete</button>
      </div>
    </form>
    <div class="mt-4 p-3 bg-slate-50 rounded-xl text-center"><span class="text-2xl font-bold text-slate-800">${p.sales}</span><span class="text-sm text-slate-500 ml-2">total sales</span></div>
  `);
}
function saveProduct(id,form){
  const fd=new FormData(form);const p=state.products.find(x=>x.id===id);
  p.price=parseInt(fd.get('price'));p.status=fd.get('status');p.desc=fd.get('desc');
  closeModal();renderProducts();
}
function confirmDeleteProduct(id){
  const p=state.products.find(x=>x.id===id);
  openModal(`<div class="text-center py-4"><div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4"><i data-lucide="trash-2" class="w-8 h-8 text-red-500"></i></div><h3 class="text-xl font-bold text-slate-800 mb-2">Delete Product</h3><p class="text-sm text-slate-500 mb-6">Delete <b>${p.name}</b>? This can't be undone.</p><div class="flex gap-3"><button onclick="closeModal();openProductDetail(${id})" class="flex-1 py-2.5 bg-slate-100 text-slate-700 rounded-xl text-sm font-semibold hover:bg-slate-200 transition-all">Cancel</button><button onclick="state.products=state.products.filter(x=>x.id!==${id});closeModal();renderProducts()" class="flex-1 py-2.5 bg-red-600 text-white rounded-xl text-sm font-semibold hover:bg-red-700 transition-all">Delete</button></div></div>`);
}
function openAddProduct(){
  openModal(`
    <div class="flex items-center justify-between mb-6"><h3 class="text-xl font-bold text-slate-800">Add Product</h3><button onclick="closeModal()" class="p-2 rounded-xl hover:bg-slate-100"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button></div>
    <form onsubmit="event.preventDefault();addProduct(this)" class="space-y-4">
      <div><label class="text-sm font-medium text-slate-700">Name</label><input name="name" required class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
      <div><label class="text-sm font-medium text-slate-700">Description</label><textarea name="desc" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none h-20"></textarea></div>
      <div class="grid grid-cols-2 gap-3">
        <div><label class="text-sm font-medium text-slate-700">Price ($)</label><input name="price" type="number" value="0" min="0" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
        <div><label class="text-sm font-medium text-slate-700">Category</label><select name="category" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"><option>Subscription</option><option>License</option><option>Add-on</option><option>Service</option><option>Promotion</option></select></div>
      </div>
      <button type="submit" class="w-full py-3 bg-vermillion-600 text-white rounded-xl font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">Add Product</button>
    </form>`);
}
function addProduct(form){
  const fd=new FormData(form);
  state.products.push({id:Date.now(),name:fd.get('name'),price:parseInt(fd.get('price')),stock:999,category:fd.get('category'),status:'active',sales:0,desc:fd.get('desc')||'New product',icon:'package'});
  closeModal();renderProducts();
}

// =============================================
// SETTINGS PAGE
// =============================================
function renderSettings(){
  const s=state.settings;
  const pc=document.getElementById('pageContent');
  pc.innerHTML=`
    <div class="max-w-2xl space-y-6">
      <!-- Profile -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up">
        <h2 class="text-lg font-bold text-slate-800 mb-4">Profile</h2>
        <form onsubmit="event.preventDefault();saveProfile(this)" class="space-y-4">
          <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-vermillion-400 to-vermillion-600 flex items-center justify-center text-white text-xl font-bold" id="settingsAvatar">${s.name.split(' ').map(w=>w[0]).join('')}</div>
            <div><div class="text-sm font-semibold text-slate-800">${s.name}</div><div class="text-xs text-slate-500">${s.email}</div></div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div><label class="text-sm font-medium text-slate-700">Full Name</label><input name="name" value="${s.name}" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
            <div><label class="text-sm font-medium text-slate-700">Email</label><input name="email" type="email" value="${s.email}" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
          </div>
          <div><label class="text-sm font-medium text-slate-700">Company</label><input name="company" value="${s.company}" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
          <button type="submit" class="px-6 py-2.5 bg-vermillion-600 text-white rounded-xl text-sm font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">Save Profile</button>
          <span id="profileSaved" class="text-sm text-emerald-600 font-medium ml-3 hidden">Saved!</span>
        </form>
      </div>
      <!-- Notifications -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:100ms">
        <h2 class="text-lg font-bold text-slate-800 mb-4">Notifications</h2>
        <div class="space-y-4">
          ${Object.entries({email:'Email Notifications',push:'Push Notifications',weekly:'Weekly Digest',marketing:'Marketing Emails'}).map(([k,l])=>`
          <div class="flex items-center justify-between">
            <div><div class="text-sm font-medium text-slate-700">${l}</div><div class="text-xs text-slate-500">${k==='email'?'Receive alerts via email':k==='push'?'Browser push notifications':k==='weekly'?'Weekly summary report':'Product updates and offers'}</div></div>
            <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer" ${s.notifications[k]?'checked':''} onchange="state.settings.notifications.${k}=this.checked"><div class="w-11 h-6 bg-slate-200 peer-focus:ring-2 peer-focus:ring-vermillion-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-vermillion-600 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div></label>
          </div>`).join('')}
        </div>
      </div>
      <!-- Danger Zone -->
      <div class="bg-white rounded-2xl p-6 border border-red-200 shadow-sm animate-slide-up" style="animation-delay:200ms">
        <h2 class="text-lg font-bold text-red-600 mb-2">Danger Zone</h2>
        <p class="text-sm text-slate-500 mb-4">Irreversible actions for your account.</p>
        <div class="flex gap-3">
          <button onclick="confirmResetData()" class="px-4 py-2 bg-red-50 text-red-700 rounded-xl text-sm font-semibold hover:bg-red-100 transition-all">Reset All Data</button>
        </div>
      </div>
    </div>`;
  lucide.createIcons();
}
function saveProfile(form){
  const fd=new FormData(form);
  state.settings.name=fd.get('name');state.settings.email=fd.get('email');state.settings.company=fd.get('company');
  document.getElementById('userName').textContent=state.settings.name;
  document.getElementById('userEmail').textContent=state.settings.email;
  document.getElementById('userAvatar').textContent=state.settings.name.split(' ').map(w=>w[0]).join('');
  document.getElementById('settingsAvatar').textContent=state.settings.name.split(' ').map(w=>w[0]).join('');
  const saved=document.getElementById('profileSaved');saved.classList.remove('hidden');setTimeout(()=>saved.classList.add('hidden'),2000);
}
function confirmResetData(){
  openModal(`<div class="text-center py-4"><div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4"><i data-lucide="alert-triangle" class="w-8 h-8 text-red-500"></i></div><h3 class="text-xl font-bold text-slate-800 mb-2">Reset All Data</h3><p class="text-sm text-slate-500 mb-6">This will reset all customers, orders, and products to defaults. This cannot be undone.</p><div class="flex gap-3"><button onclick="closeModal()" class="flex-1 py-2.5 bg-slate-100 text-slate-700 rounded-xl text-sm font-semibold hover:bg-slate-200 transition-all">Cancel</button><button onclick="location.reload()" class="flex-1 py-2.5 bg-red-600 text-white rounded-xl text-sm font-semibold hover:bg-red-700 transition-all">Reset</button></div></div>`);
}

// =============================================
// HELP CENTER PAGE
// =============================================
let helpSearch='';
function renderHelp(){
  const pc=document.getElementById('pageContent');
  const filtered=helpSearch?state.helpArticles.filter(a=>a.q.toLowerCase().includes(helpSearch.toLowerCase())||a.a.toLowerCase().includes(helpSearch.toLowerCase())):state.helpArticles;
  pc.innerHTML=`
    <div class="max-w-2xl mx-auto">
      <div class="text-center mb-8 animate-slide-up">
        <div class="w-16 h-16 rounded-2xl bg-vermillion-100 flex items-center justify-center mx-auto mb-4"><i data-lucide="help-circle" class="w-8 h-8 text-vermillion-600"></i></div>
        <h2 class="text-2xl font-bold text-slate-800 mb-2">How can we help?</h2>
        <div class="relative max-w-md mx-auto mt-4"><i data-lucide="search" class="w-4 h-4 absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i><input type="text" placeholder="Search help articles..." value="${helpSearch}" oninput="helpSearch=this.value;renderHelp()" class="w-full pl-11 pr-4 py-3 bg-white border border-slate-200 rounded-2xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none shadow-sm"></div>
      </div>
      <div class="space-y-3 mb-8">
        ${filtered.map((a,i)=>`
        <div class="bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden animate-slide-up" style="animation-delay:${i*50}ms">
          <button onclick="this.parentElement.querySelector('.faq-answer').classList.toggle('hidden');this.querySelector('.faq-chevron').classList.toggle('rotate-180')" class="w-full flex items-center justify-between p-5 text-left hover:bg-slate-50 transition-colors">
            <span class="text-sm font-semibold text-slate-800">${a.q}</span>
            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 faq-chevron transition-transform"></i>
          </button>
          <div class="faq-answer hidden px-5 pb-5"><p class="text-sm text-slate-600 leading-relaxed">${a.a}</p></div>
        </div>`).join('')}
        ${filtered.length===0?'<p class="text-center text-slate-400 py-8">No articles match your search.</p>':''}
      </div>
      <!-- Contact Form -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm animate-slide-up" style="animation-delay:300ms">
        <h3 class="text-lg font-bold text-slate-800 mb-1">Still need help?</h3>
        <p class="text-sm text-slate-500 mb-4">Send us a message and we'll get back to you.</p>
        <form onsubmit="event.preventDefault();submitContactForm(this)" class="space-y-4">
          <div><label class="text-sm font-medium text-slate-700">Subject</label><input name="subject" required class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></div>
          <div><label class="text-sm font-medium text-slate-700">Message</label><textarea name="message" required rows="4" class="w-full mt-1 px-4 py-2 border border-slate-200 rounded-xl text-sm focus:border-vermillion-300 focus:ring-2 focus:ring-vermillion-100 outline-none"></textarea></div>
          <button type="submit" class="px-6 py-2.5 bg-vermillion-600 text-white rounded-xl text-sm font-semibold hover:bg-vermillion-700 active:scale-[0.98] transition-all">Send Message</button>
          <span id="contactSent" class="text-sm text-emerald-600 font-medium ml-3 hidden">Message sent! We'll respond within 24 hours.</span>
        </form>
      </div>
    </div>`;
  lucide.createIcons();
}
function submitContactForm(form){
  const sent=document.getElementById('contactSent');sent.classList.remove('hidden');
  form.reset();setTimeout(()=>sent.classList.add('hidden'),4000);
}

// =============================================
// INIT
// =============================================
buildSidebar();
navigate('dashboard');
updateNotifBadge();
const savedTheme=localStorage.getItem('pulse-theme');
if(savedTheme==='dark'||savedTheme==='light')state.settings.theme=savedTheme;
applyTheme(state.settings.theme);
</script>
</body>
</html>
